<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.mapper.PreorderMapper">

    <!-- 단말 등록 -->
    <insert id="insertDeviceInfo" parameterType="com.example.dto.DeviceInfoDto">
        INSERT INTO device (
            product_id,
            product_name,
            brand,
            model,
            color,
            capacity,
            price
        ) VALUES (
                     #{productId},
                     #{productName},
                     #{brand},
                     #{model},
                     #{color},
                     #{capacity},
                     #{price}
                 )
    </insert>

    <!-- 이벤트 등록 -->
    <insert id="insertEventInfo" parameterType="com.example.dto.PreorderEventReqDto">
        INSERT INTO preorder_event (
            event_id,
            event_name,
            start_time,
            end_time,
            preorder_type,
            benefit_description,
            max_order_per_user
        ) VALUES (
                     #{eventId},
                     #{eventName},
                     #{startTime},
                     #{endTime},
                     #{preorderType},
                     #{benefitDescription},
                     #{maxOrderPerUser}
                 )
    </insert>

    <!-- 이벤트-단말 매핑 등록 -->
    <insert id="insertEventDeviceMap">
        INSERT INTO event_device_map (event_id, product_id)
        VALUES
        <foreach collection="productIds" item="productId" separator=",">
            (#{eventId}, #{productId})
        </foreach>
    </insert>

    <!-- 이벤트별 단말 정보 조회 -->
    <select id="selectDevicesByEventId" parameterType="string" resultType="com.example.dto.DeviceInfoDto">
        SELECT d.product_id,
               d.product_name,
               d.brand,
               d.model,
               d.color,
               d.capacity,
               d.price
        FROM device d
            INNER JOIN event_device_map edm
            ON d.product_id = edm.product_id
        WHERE edm.event_id = #{eventId}
    </select>

</mapper>
